import{r as o,j as a,M as R,k as b,B as p,N as y,a as w,$ as Y,m as ee}from"./index-BwQ9_pH1.js";import{s as ae,b as te,m as se,h as oe,n as re}from"./productService-Bt3BsnKr.js";import{E as le,N as x}from"./index-DTkkQkBg.js";const G={"addCatalog-modal":"_addCatalog-modal_kvtei_1","AddCatalog-button":"_AddCatalog-button_kvtei_8"},he=({isOpen:g,onClose:c})=>{const[r,n]=o.useState(null),h=l=>{l.target.files&&n(l.target.files[0])},_=async()=>{if(r)try{if((await ae(r)).data.allSaved==!0)c(),y.addNotification("Каталог","Каталог успешно добавлен","success");else throw new Error("Произошла ошибка")}catch(l){console.error(l),c(),y.addNotification("Каталог","Ошибка при добавлении каталога","error")}};return a.jsxs(R,{className:G["addCatalog-modal"],opened:g,onClose:c,title:"Добавьте Товар",children:[a.jsx(b,{type:"file",onChange:h}),a.jsx("p",{style:{color:"grey"},children:"Допустимые форматы: xlsx, pdf"}),a.jsx(p,{className:G["AddCatalog-button"],variantColor:"primary",onClick:_,children:"Добавить Каталог"})]})},ne="_fileUpload_1gvch_15",ce="_uploadButton_1gvch_23",ie="_fileInfo_1gvch_40",C={"addCatalog-modal":"_addCatalog-modal_1gvch_1","AddCatalog-button":"_AddCatalog-button_1gvch_9",fileUpload:ne,uploadButton:ce,fileInfo:ie},me=({isOpen:g,onClose:c,isAdmin:r=!0,profileData:n})=>{const[h,_]=o.useState([]),[l,Z]=o.useState(""),[v,K]=o.useState(""),[L,$]=o.useState(""),[D,E]=o.useState([]),[I,V]=o.useState(""),[S,z]=o.useState([]),[P,j]=o.useState([]),[O,X]=o.useState([]),[N,H]=o.useState([]),[A,F]=o.useState(!1),[k,m]=o.useState(""),[t,M]=o.useState({accountId:r?"":n.id.toString(),name:"",description:"",quantity:1,price:0,brandId:null,KZTIN:null,GTIN:null,ENSTRU:null,subcategoryId:null}),J=e=>{if(e.target.files){const s=Array.from(e.target.files);if(s.filter(f=>f.size>T*1024*1024).length>0){m(`Файл(ы) превышают ${T}MB`);return}H(s),m("")}};o.useEffect(()=>{g&&(async()=>{try{const[s,d,f]=await Promise.all([Y(),ee(),te()]),U=s.data.records.map(u=>({value:u.id.toString(),label:u.name}));z(U),j(U);const q=d.data.records.map(u=>({value:u.id.toString(),label:u.name}));_(q),E(q);const W=f.data.records.map(u=>({value:u.id.toString(),label:u.firstName}));X(W)}catch(s){console.error("Ошибка загрузки поставщиков:",s)}})()},[g]),o.useEffect(()=>{I.trim()===""?j(S):j(S.filter(e=>e.label.toLowerCase().includes(I.toLowerCase())))},[I,S]),o.useEffect(()=>{E(l.trim()===""?h:h.filter(e=>e.label.toLowerCase().includes(l.toLowerCase())))},[l,h]);const i=(e,s)=>{let d=s;M(f=>({...f,[e]:d}))},T=5,Q=async()=>{var e;if(m(""),!t.accountId){m("Выберите поставщика");return}if(!t.name){m("Выберите название товара");return}if(!t.price){m("Выберите цену товара");return}if(N.length===0){m("Загрузите хотя бы одно изображение");return}try{F(!0);const s=await se({name:t.name,description:t.description,quantity:t.quantity||0,price:t.price||0,KZTIN:t.KZTIN,GTIN:t.GTIN,ENCTRU:t.ENSTRU,brandId:t.brandId,subcategoryId:t.subcategoryId||1,amountPrice:0,rating:0});if(!s)return"erore";const d=(e=s==null?void 0:s.data)==null?void 0:e.id;await oe(N,d),await re({productId:d,vendorId:parseInt(t.accountId,10),price:t.price.toString(),features:{isBonus:v!=0,isDiscount:v!=0,bonus:v,discount:L}}),y.addNotification("Добавление товара",`Товар c номером ${d} успешно добавлен`,"success")}catch(s){y.addNotification("Добавление товара","Что-то пошло не так","error"),console.error("Ошибка:",s)}finally{F(!1),c()}};return a.jsxs(R,{className:C["addCatalog-modal"],opened:g,onClose:c,title:"Добавьте Товар",children:[a.jsx(w,{label:"Поставщик",required:!0,disabled:!r,data:r?O:[{value:n.id.toString(),label:n.firstName}],value:t.accountId,onChange:e=>i("accountId",e??""),placeholder:"Выберите имя поставщика"}),a.jsx(b,{required:!0,label:"Название товара",value:t.name,onChange:e=>i("name",e.currentTarget.value)}),a.jsx(w,{label:"Категории",data:P,searchable:!0,searchValue:I,onSearchChange:V,placeholder:"Введите категорию...",value:t.subcategoryId,onChange:e=>{M(s=>({...s,subcategoryId:e}))}}),a.jsx("label",{htmlFor:"mdEditor",children:"Описание"}),a.jsx(le,{id:"mdEditor",value:t.description,onChange:e=>i("description",e),height:400}),a.jsx(x,{label:"Количество",value:t.quantity,onChange:e=>i("quantity",e??0)}),a.jsx(x,{label:"Цена",value:t.price,onChange:e=>i("price",e??0)}),a.jsxs("div",{className:C.fileUpload,children:[a.jsxs("label",{htmlFor:"fileInput",className:C.uploadButton,children:["Загрузить файлы (Макс ",T,"MB)"]}),a.jsx("input",{required:!0,type:"file",id:"fileInput",multiple:!0,onChange:J}),a.jsx("span",{className:C.fileInfo,children:N.length>0?`${N.length} файл(ов) выбрано`:"Файлы не выбраны"})]}),a.jsx(w,{label:"Бренд",data:D,searchable:!0,searchValue:l,onSearchChange:Z,placeholder:"Введите бренд..."}),a.jsx(x,{label:"Бонус %",max:100,min:0,placeholder:"Введите бонус (0 - 100)",onChange:e=>K(e)}),a.jsx(x,{label:"Скидка %",max:100,min:0,placeholder:"Введите бонус (0 - 100)",onChange:e=>$(e)}),a.jsx(b,{label:"KZTIN",placeholder:"Введите KZTIN",value:t.KZTIN??"",onChange:e=>i("KZTIN",e.currentTarget.value)}),a.jsx(b,{label:"ЕНС ТРУ",placeholder:"Введите ЕНС ТРУ",value:t.ENSTRU??"",onChange:e=>i("ENSTRU",e.currentTarget.value)}),a.jsx(b,{label:"GTIN",placeholder:"Введите GTIN",value:t.GTIN??"",onChange:e=>i("GTIN",e.currentTarget.value)}),k&&a.jsx("p",{className:"danger",children:k}),a.jsx(p,{className:C["AddCatalog-button"],variantColor:"primary",onClick:Q,disabled:A,children:A?"Добавление...":"Добавить Товар"})]})},B={"catalog-header":"_catalog-header_w3j7g_1","catalog-filter":"_catalog-filter_w3j7g_7","catalog-actions":"_catalog-actions_w3j7g_14"},pe=({addCatalog:g,isAdmin:c=!0,onFilterChange:r,filterPeriod:n,addProduct:h})=>a.jsxs("div",{className:B["catalog-header"],children:[a.jsxs("div",{className:B["catalog-filter"],children:[a.jsx(p,{onClick:()=>r("3_months"),variantColor:n=="3_months"?"primary":"secondary",children:"За 3 месяца"}),a.jsx(p,{onClick:()=>r("6_months"),variantColor:n=="6_months"?"primary":"secondary",children:"За 6 месяцев"}),a.jsx(p,{onClick:()=>r("1_year"),variantColor:n=="1_year"?"primary":"secondary",children:"За год"})]}),a.jsxs("div",{className:B["catalog-actions"],children:[c&&a.jsx(p,{onClick:g,variantColor:"secondary",children:"Добавить каталог"}),a.jsx(p,{onClick:h,variantColor:"primary",children:"Создать товар"})]})]});export{he as A,pe as C,me as a};
