import{r as s,i as N,j as a,S as D}from"./index-BwQ9_pH1.js";import{b as F}from"./productService-Bt3BsnKr.js";import{C as M,T as O}from"./CatalogSwitch-C6lV_NV4.js";import{C as w,A as v,a as E}from"./CatalogFilters-VLzH3msv.js";import"./procentService-u-au2y4b.js";import"./clamp-DTmYCdls.js";import"./index-DTkkQkBg.js";const r={"catalog-page":"_catalog-page_p29e0_1","catalog-title":"_catalog-title_p29e0_11","catalog-description":"_catalog-description_p29e0_15","catalog-tenders":"_catalog-tenders_p29e0_20"},B=()=>{const[l,x]=s.useState("3_months"),[d,C]=s.useState(!1),[c,j]=s.useState(!1),[i,A]=s.useState([]),[S,g]=s.useState(!0),[p,P]=s.useState(null),m=s.useCallback(t=>{const e=new Date;return t==="3_months"?e.setMonth(e.getMonth()-3):t==="6_months"?e.setMonth(e.getMonth()-6):t==="1_year"&&e.setFullYear(e.getFullYear()-1),e},[]),f=s.useCallback(async()=>{var t;try{g(!0);const[e,_]=await Promise.all([F(),N()]);let o=((t=e.data)==null?void 0:t.records)||[];const y=m(l);o=o.filter(n=>new Date(n.createdAt)>=y),_.role!=="admin"&&(o=o.filter(n=>n.firstName===_.firstName)),A(o)}catch(e){P(`Failed to load vendor data: ${e}`)}finally{g(!1)}},[l,m]);s.useEffect(()=>{f()},[f]);const u=()=>j(t=>!t),h=()=>C(t=>!t);return a.jsxs("div",{className:r["catalog-page"],children:[a.jsx(M,{}),a.jsx("p",{className:r["catalog-title"],children:"Каталог"}),a.jsxs("p",{className:r["catalog-description"],children:["Топ - ",i.length]}),a.jsx(w,{onFilterChange:x,addCatalog:u,addProduct:h,filterPeriod:l}),a.jsx("div",{className:r["catalog-tenders"],children:S?Array.from({length:3}).map((t,e)=>a.jsx(D,{style:{marginBottom:"30px"},width:"100%",height:200,radius:30},e)):i.map(t=>a.jsx(O,{user:t},t.id))}),c&&a.jsx(v,{isOpen:c,onClose:u}),d&&a.jsx(E,{isOpen:d,onClose:h}),p&&a.jsx("p",{className:r.error,children:p})]})};export{B as default};
