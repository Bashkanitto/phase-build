import{j as t,r as c,S as D,a as P,T as e,b as k,f as B,N as S,c as M,P as V,C as Y,d as $,e as H}from"./index-BwQ9_pH1.js";import{f as Q,p as R,a as z}from"./productService-Bt3BsnKr.js";const G={"content-layout":"_content-layout_1g9xh_1"},U="_statusRow_632wf_38",q="_status_632wf_38",J="_statusNotBtn_632wf_47",K="_statusYesBtn_632wf_59",p={"security-page-table-head":"_security-page-table-head_632wf_1","security-page-table":"_security-page-table_632wf_1",statusRow:U,status:q,statusNotBtn:J,statusYesBtn:K,"mantine-Table-td":"_mantine-Table-td_632wf_71"},F=({children:l})=>{switch(l){case"active":return t.jsx("p",{style:{textAlign:"center",padding:"5px 10px",borderRadius:"10px"},className:"active activebg",children:"Разрешено"});case"pending":return t.jsx("p",{style:{textAlign:"center",padding:"5px 10px",borderRadius:"10px"},className:"warning warningbg",children:"В ожидании"});case"inactive":return t.jsx("p",{style:{textAlign:"center",padding:"5px 10px",borderRadius:"10px"},className:"danger dangerbg",children:"Отклонено"});default:return t.jsx("p",{children:"Неизвестный статус"})}},O=()=>{const[l,h]=c.useState([]),[j,w]=c.useState(""),[m,g]=c.useState(!1),[f,_]=c.useState(null),{userProfile:N}=k,y=N.id;c.useEffect(()=>{(async()=>{g(!0),_(null);try{const a=await Q(y);h(a.data.records)}catch(a){_("Failed to load products"),console.error(a),h([])}finally{g(!1)}})()},[]);const v=async(n,a)=>{try{const T=l.map(o=>o.product.id===n?{...o,product:{...o.product,status:a}}:o);h(T),await R(n,a),S.addNotification("Заявка",`Заявка продукта под номером ${n} успешно изменена`,"success")}catch(T){console.log(T);const o=l.map(b=>b.product.id===n?{...b,product:{...b.product,status:"active"}}:b);h(o),S.addNotification("Заявка","Произошла ошибка при попытке измененить заявку","error")}};if(m)return t.jsx(D,{});if(f)return t.jsxs("div",{children:["Ошибка: ",f]});const A=()=>{const n=j?l.filter(a=>a.product.status===j):l;return Array.isArray(n)?n.map(a=>t.jsxs(e.Tr,{children:[t.jsx(e.Td,{children:a.id}),t.jsx(e.Td,{children:a.product.name}),t.jsx(e.Td,{children:B(new Date(a.product.createdAt),"dd MMMM, yyyy",{locale:M})}),t.jsx(e.Td,{children:t.jsx(F,{children:a.product.status})}),t.jsx(e.Td,{children:t.jsx("button",{style:{float:"right"},className:p.statusNotBtn,onClick:()=>v(a.product.id,"inactive"),children:t.jsx("img",{src:"/images/diskLike_photo.svg",alt:""})})})]},a.id)):null};return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:p["security-page-table-head"],children:t.jsxs("div",{children:[t.jsx("input",{type:"text",placeholder:"Поиск"}),t.jsx(P,{placeholder:"Статус",data:[{value:"",label:"Все"},{value:"active",label:"Разрешено"},{value:"pending",label:"В ожидании"},{value:"inactive",label:"Отклонено"}],onChange:n=>w(n)})]})}),t.jsx("div",{className:p["security-page-table"],children:t.jsxs(e,{stickyHeader:!0,children:[t.jsx(e.Thead,{children:t.jsxs(e.Tr,{children:[t.jsx(e.Th,{children:"ID"}),t.jsx(e.Th,{children:"Продукт"}),t.jsx(e.Th,{children:"Дата"}),t.jsx(e.Th,{children:"Статус"}),t.jsx(e.Th,{style:{textAlign:"end"},children:"Действие"})]})}),t.jsx(e.Tbody,{children:A()})]})})]})},W=()=>{const[l,h]=c.useState([]),[j,w]=c.useState(""),[m,g]=c.useState(!1),[f,_]=c.useState(""),[N,y]=c.useState(null),[v,A]=c.useState(1),[n]=c.useState(7),[a,T]=c.useState(1);c.useEffect(()=>{(async()=>{var i;g(!0),y(null);try{const r=await z(v,n);h(r.data.records),T(((i=r.data.meta)==null?void 0:i.totalPages)||Math.ceil(r.data.records.length/n))}catch(r){y("Не удалось загрузить данные"),console.error(r)}finally{g(!1)}})()},[v,n]);const o=async(s,i)=>{try{h(r=>r.map(u=>{var d;return((d=u.product)==null?void 0:d.id)===s?{...u,product:{...u.product,status:i}}:u})),await R(s,i),S.addNotification("Заявка",`Заявка продукта под номером ${s} успешно изменена`,"success")}catch(r){y("Не удалось изменить статус продукта"),console.error(r);const u=l.map(d=>{var x;return((x=d.product)==null?void 0:x.id)===s?{...d,product:{...d.product,status:"active"}}:d});h(u),S.addNotification("Заявка","Произошла ошибка при попытке измененить заявку","error")}finally{g(!1)}};if(m)return t.jsx(D,{});if(N)return t.jsxs("div",{children:["Ошибка: ",N]});const C=l.filter(s=>s.product!==null).filter(s=>{var r;return(((r=s.product)==null?void 0:r.name.toLowerCase())||"").includes(f.toLowerCase())}),L=j?C.filter(s=>s.product.status===j):C,E=()=>L.map(s=>{var i,r,u,d;return t.jsxs(e.Tr,{children:[t.jsx(e.Td,{children:(i=s.product)==null?void 0:i.id}),t.jsx(e.Td,{children:t.jsx("a",{href:`/product/${(r=s.product)==null?void 0:r.id}`,children:(u=s.product)==null?void 0:u.name})}),t.jsx(e.Td,{children:s.vendor.firstName}),t.jsx(e.Td,{children:t.jsx(F,{children:(d=s.product)==null?void 0:d.status})}),t.jsx(e.Td,{children:B(new Date(s.createdAt),"dd MMMM, yyyy",{locale:M})}),t.jsxs(e.Td,{style:{textAlign:"end",display:"flex",gap:"5px",justifyContent:"flex-end"},children:[t.jsx("button",{className:p.statusNotBt,onClick:()=>{var x;return o((x=s.product)==null?void 0:x.id,"inactive")},children:t.jsx("img",{src:"/images/diskLike_photo.svg",alt:""})}),t.jsx("button",{className:p.statusYesBtn,onClick:()=>{var x;return o((x=s.product)==null?void 0:x.id,"active")},children:t.jsx("img",{src:"/images/like_photo.svg",alt:""})})]})]},s.id)});return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:p["security-page-table-head"],children:[t.jsxs("div",{children:[t.jsx("input",{type:"text",placeholder:"Поиск",value:f,onChange:s=>_(s.target.value)}),t.jsx(P,{placeholder:"Статус",defaultValue:j,data:[{value:"",label:"Все"},{value:"active",label:"Разрешено"},{value:"pending",label:"В ожидании"},{value:"inactive",label:"Отклонено"}],onChange:s=>w(s)})]}),t.jsx(V,{page:v,totalPages:a,onPageChange:s=>A(s)})]}),t.jsx("div",{className:p["security-page-table"],children:t.jsxs(e,{stickyHeader:!0,children:[t.jsx(e.Thead,{children:t.jsxs(e.Tr,{children:[t.jsx(e.Th,{children:"ID заказа"}),t.jsx(e.Th,{children:"Продукт"}),t.jsx(e.Th,{children:"Продавец"}),t.jsx(e.Th,{style:{textAlign:"center"},children:"Статус"}),t.jsx(e.Th,{children:"Дата"}),t.jsx(e.Th,{style:{textAlign:"end"},children:"Действие"})]})}),t.jsx(e.Tbody,{children:E()})]})})]})},I=()=>{const{isAdmin:l}=k;return t.jsx(Y,{className:G["withdraws-page"],header:t.jsxs(t.Fragment,{children:[t.jsx($,{title:"Заявки"}),t.jsx(H,{})]}),children:t.jsx("div",{children:l?t.jsx(W,{}):t.jsx(O,{})})})};export{I as default};
