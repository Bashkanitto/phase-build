import{r as n,j as e,S as H,a as v,P as q,B as I,T as a,O as M,M as L,U as b,V as O,W as V,N as h,X as W,f as m,D as X,Y,c as G,C as J,d as K,e as Q}from"./index-BwQ9_pH1.js";const Z={"content-layout":"_content-layout_1g9xh_1"},k={"security-page-table-head":"_security-page-table-head_1qmy4_1","security-page-table":"_security-page-table_1qmy4_1"},ee=()=>{const[r,d]=n.useState([]),[o,u]=n.useState([]),[x,y]=n.useState(null),[c,i]=n.useState({deleteModal:!1,editModal:!1}),[g,A]=n.useState(null),[N,S]=n.useState(!1),[T,w]=n.useState(null),[j,E]=n.useState(1),[C]=n.useState(10),[_,D]=n.useState(1);n.useEffect(()=>{(async()=>{S(!0),w(null);try{const t=await O(j,C);u(t.data.records),D(t.data.meta.totalPages)}catch(t){w("Failed to load accounts"),console.error(t)}finally{S(!1)}})()},[j,C]);const P=async()=>{if(x)try{if((await V(x)).status!==200)throw new Error("Failed to delete account");h.addNotification("Успешно","Аккаунт успешно удален","success"),u(o.filter(t=>t.id!==x))}catch(s){console.error(s),h.addNotification("Ошибка","Произошла ошибка при удалении аккаунта","error")}finally{i({...c,deleteModal:!1}),y(null)}},F=s=>{y(s),i({...c,deleteModal:!0})},B=async(s,t)=>{try{if((await Y(s,t)).error)throw new Error("Failed to update status");u(p=>p.map(f=>f.id===s?{...f,status:t}:f)),h.addNotification("Успешно","Статус обновлен","success")}catch(l){console.error(l),h.addNotification("Ошибка","Не удалось обновить статус","error")}};if(N)return e.jsx(H,{});if(T)return e.jsxs("div",{children:["Error: ",T]});const z=()=>{const s=new W;s.setFontSize(12),o.forEach((t,l)=>{s.text(`${l+1}. ${t.firstName} - ${t.role} - ${m(new Date(t.createdAt),"dd.MM.yy - HH:mm")}`,10,50+l*10)}),s.save("managers_report.pdf")},R=s=>{const{checked:t}=s.target;d(t?o.map(l=>l.id):[])},$=s=>t=>{const{checked:l}=t.target;d(l?[...r,s]:r.filter(p=>p!==s))},U=()=>(g?o.filter(t=>t.status===g):o).map(t=>e.jsxs(a.Tr,{children:[e.jsx(a.Td,{style:{width:"16px"},children:e.jsx(M,{size:"xs",checked:r.includes(t.id),onChange:$(t.id)})}),e.jsx(a.Td,{children:t.firstName}),e.jsx(a.Td,{children:e.jsx(v,{data:[{value:"active",label:"Активный"},{value:"inactive",label:"Неактивный"}],value:t.status,onChange:l=>B(t.id,l),size:"xs",style:{width:"120px"}})}),e.jsx(a.Td,{children:m(t.updatedAt,"dd MMMM, yyyy",{locale:G})}),e.jsx(a.Td,{style:{width:"50px",padding:"0"},children:e.jsx(X,{onClick:()=>F(t.id)})})]},t.id));return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:k["security-page-table-head"],children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",placeholder:"Поиск"}),e.jsx(v,{placeholder:"Статус",data:[{value:"",label:"Все"},{value:"Создано",label:"Создано"},{value:"Подтверждено",label:"Подтверждено"}],onChange:s=>A(s),value:g||""})]}),e.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[e.jsx(q,{page:j,totalPages:_,onPageChange:s=>E(s)}),e.jsx(I,{onClick:z,children:"Экспорт"})]})]}),e.jsx("div",{className:k["security-page-table"],children:e.jsxs(a,{stickyHeader:!0,children:[e.jsx(a.Thead,{children:e.jsxs(a.Tr,{children:[e.jsx(a.Th,{children:e.jsx(M,{size:"xs",checked:r.length===o.length,indeterminate:r.length>0&&r.length<o.length,onChange:R})}),e.jsx(a.Th,{children:"Пользователь"}),e.jsx(a.Th,{children:"Статус"}),e.jsx(a.Th,{children:"Последнее обновление"}),e.jsx(a.Th,{style:{width:"150px",padding:"0"},children:"Действие"})]})}),e.jsx(a.Tbody,{children:U()})]})}),e.jsxs(L,{opened:c.deleteModal,onClose:()=>i({...c,deleteModal:!1}),withCloseButton:!1,title:"Удаление аккаунта",children:[e.jsx("p",{children:"Вы уверены, что хотите удалить этот аккаунт?"}),e.jsx(b,{onClick:()=>i({...c,deleteModal:!1}),children:"Отмена"}),e.jsx(b,{onClick:P,color:"red",children:"Удалить"})]})]})},se=()=>e.jsx(J,{className:Z["withdraws-page"],header:e.jsxs(e.Fragment,{children:[e.jsx(K,{title:"Безопасность"}),e.jsx(Q,{})]}),children:e.jsx("div",{children:e.jsx(ee,{})})});export{se as default};
